<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - MapLeads AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase SDK (Version 9 - Modular) -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
        import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        // TODO: Replace with your actual Firebase config from Console
        // 1. Go to console.firebase.google.com
        // 2. Create Project -> Add Web App
        // 3. Copy config here
        const firebaseConfig = {
            apiKey: "AIzaSyBRV-FMPWzjDWeNzYPzCC6f7JeTRMhRXYM",
            authDomain: "maps-scrapper-6d3f9.firebaseapp.com",
            projectId: "maps-scrapper-6d3f9",
            storageBucket: "maps-scrapper-6d3f9.firebasestorage.app",
            messagingSenderId: "211512782217",
            appId: "1:211512782217:web:f0b87db923652fc1b8c558"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        const loginBtn = document.getElementById('loginBtn');
        const dashboard = document.getElementById('dashboard');
        const loginScreen = document.getElementById('loginScreen');

        const clientDashboardUrl = '/client/index.html'; // Adjust logic if hosted differently

        // Login Logic
        if (loginBtn) {
            loginBtn.addEventListener('click', () => {
                console.log("Login button clicked");
                signInWithPopup(auth, provider)
                    .then((result) => {
                        console.log("Logged in:", result.user.email);
                        if (result.user.email !== 'samadly728@gmail.com') {
                            // If not admin, redirect to Client Dashboard
                            console.log("Not admin, redirecting to Client Dashboard");
                            window.location.href = clientDashboardUrl;
                        } else {
                            // Is Admin
                            console.log("Admin logged in");
                        }
                    }).catch((error) => {
                        console.error("Login Error:", error);
                        alert("Login Failed: " + error.message);
                    });
            });
        } else {
            console.error("Login button element not found in DOM");
        }

        // Auth State Listener
        onAuthStateChanged(auth, (user) => {
            if (user) {
                if (user.email === 'samadly728@gmail.com') {
                    loginScreen.classList.add('hidden');
                    dashboard.classList.remove('hidden');
                    loadStats();
                } else {
                    // Logged in but not admin, redirect
                    window.location.href = clientDashboardUrl;
                }
            } else {
                loginScreen.classList.remove('hidden');
                dashboard.classList.add('hidden');
            }
        });

        async function loadStats() {
            // Mock Data for now (replace with Firestore queries later)
            // const querySnapshot = await getDocs(collection(db, "users"));
            // ...

            document.getElementById('totalUsers').innerText = "1,245";
            document.getElementById('monthlyRev').innerText = "$3,490";
            document.getElementById('leadsScraped').innerText = "850k";

            const tbody = document.getElementById('userTable');
            tbody.innerHTML = `
                <tr class="border-b border-gray-700 hover:bg-gray-800">
                    <td class="px-6 py-4">john.doe@gmail.com</td>
                    <td class="px-6 py-4"><span class="bg-green-900 text-green-300 px-2 py-1 rounded text-xs">Pro</span></td>
                    <td class="px-6 py-4">1,500</td>
                    <td class="px-6 py-4">Jan 24, 2026</td>
                </tr>
                 <tr class="border-b border-gray-700 hover:bg-gray-800">
                    <td class="px-6 py-4">sarah.smith@agency.com</td>
                    <td class="px-6 py-4"><span class="bg-blue-900 text-blue-300 px-2 py-1 rounded text-xs">Agency</span></td>
                    <td class="px-6 py-4">50,000</td>
                    <td class="px-6 py-4">Jan 23, 2026</td>
                </tr>
            `;
        }
    </script>
</head>

<body class="bg-gray-900 text-gray-200 font-sans min-h-screen">

    <div id="loginScreen" class="h-screen flex flex-col items-center justify-center">
        <h1 class="text-3xl font-bold mb-8">Login</h1>
        <button id="loginBtn"
            class="bg-blue-600 hover:bg-blue-500 text-white px-6 py-3 rounded-lg font-bold flex items-center">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg"
                class="w-6 h-6 mr-3 bg-white rounded-full p-1">
            Sign in with Google
        </button>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="hidden">
        <!-- Sidebar -->
        <div class="fixed left-0 top-0 w-64 h-full bg-gray-800 border-r border-gray-700 p-4">
            <h2 class="text-xl font-bold text-white mb-8 px-4">MapLeads Admin</h2>
            <nav class="space-y-2">
                <a href="#" class="block px-4 py-2 bg-blue-600 text-white rounded">Overview</a>
                <a href="#" class="block px-4 py-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded">Users</a>
                <a href="#"
                    class="block px-4 py-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded">Subscriptions</a>
                <a href="#"
                    class="block px-4 py-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded">Settings</a>

                <div class="mt-8 border-t border-gray-700 pt-4">
                    <a href="/client/index.html" class="block px-4 py-2 text-green-400 hover:bg-gray-700 rounded">
                        <i class="fas fa-external-link-alt mr-2"></i> Switch to Client
                    </a>
                </div>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="ml-64 p-8">
            <h1 class="text-3xl font-bold text-white mb-8">Dashboard Overview</h1>

            <!-- Stats Grid -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-gray-800 p-6 rounded-xl border border-gray-700">
                    <h3 class="text-gray-400 text-sm font-medium mb-2">Total Users</h3>
                    <div id="totalUsers" class="text-3xl font-bold text-white">...</div>
                </div>
                <div class="bg-gray-800 p-6 rounded-xl border border-gray-700">
                    <h3 class="text-gray-400 text-sm font-medium mb-2">Monthly Revenue</h3>
                    <div id="monthlyRev" class="text-3xl font-bold text-green-400">...</div>
                </div>
                <div class="bg-gray-800 p-6 rounded-xl border border-gray-700">
                    <h3 class="text-gray-400 text-sm font-medium mb-2">Leads Scraped</h3>
                    <div id="leadsScraped" class="text-3xl font-bold text-blue-400">...</div>
                </div>
            </div>

            <!-- Recent Users -->
            <div class="bg-gray-800 rounded-xl border border-gray-700 overflow-hidden">
                <div class="p-6 border-b border-gray-700">
                    <h3 class="text-lg font-bold text-white">Recent Users</h3>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-left">
                        <thead class="bg-gray-700/50 text-gray-400 uppercase text-xs">
                            <tr>
                                <th class="px-6 py-3">Email</th>
                                <th class="px-6 py-3">Plan</th>
                                <th class="px-6 py-3">Leads</th>
                                <th class="px-6 py-3">Joined</th>
                            </tr>
                        </thead>
                        <tbody id="userTable">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</body>

</html>